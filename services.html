



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.1.0">
    
    
      
        <title>Services - Application Container Platform</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="assets/javascripts/modernizr.01ccdecf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#vpn" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="index.html" title="Application Container Platform" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Application Container Platform
            </span>
            <span class="md-header-nav__topic">
              Services
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="index.html" title="Application Container Platform" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Application Container Platform
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="index.html" title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Services
      </label>
    
    <a href="services.html" title="Services" class="md-nav__link md-nav__link--active">
      Services
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vpn" title="VPN" class="md-nav__link">
    VPN
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#source-code-management" title="Source Code Management" class="md-nav__link">
    Source Code Management
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ci" title="CI" class="md-nav__link">
    CI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#binary-artifact-storage" title="Binary / Artifact Storage" class="md-nav__link">
    Binary / Artifact Storage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#domain-name-system-dns-pattern" title="Domain Name System (DNS) Pattern" class="md-nav__link">
    Domain Name System (DNS) Pattern
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-composition" title="Application Composition" class="md-nav__link">
    Application Composition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging" title="Logging" class="md-nav__link">
    Logging
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metrics-monitoring" title="Metrics / Monitoring" class="md-nav__link">
    Metrics / Monitoring
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-and-disaster-recovery" title="Security and disaster recovery" class="md-nav__link">
    Security and disaster recovery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reusable-components" title="Reusable components" class="md-nav__link">
    Reusable components
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="releases-notes/index.html" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="how-to-docs/index.html" title="How To's" class="md-nav__link">
      How To's
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="developer-docs/index.html" title="Developer Getting Started Guide" class="md-nav__link">
      Developer Getting Started Guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="newuser.html" title="New User Guide" class="md-nav__link">
      New User Guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="rbac.html" title="RBAC Guide" class="md-nav__link">
      RBAC Guide
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="external-addresses.html" title="ACP External IPs" class="md-nav__link">
      ACP External IPs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="service-lifecycle.html" title="Service Lifecycle" class="md-nav__link">
      Service Lifecycle
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vpn" title="VPN" class="md-nav__link">
    VPN
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#source-code-management" title="Source Code Management" class="md-nav__link">
    Source Code Management
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ci" title="CI" class="md-nav__link">
    CI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#binary-artifact-storage" title="Binary / Artifact Storage" class="md-nav__link">
    Binary / Artifact Storage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#domain-name-system-dns-pattern" title="Domain Name System (DNS) Pattern" class="md-nav__link">
    Domain Name System (DNS) Pattern
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-composition" title="Application Composition" class="md-nav__link">
    Application Composition
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#logging" title="Logging" class="md-nav__link">
    Logging
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metrics-monitoring" title="Metrics / Monitoring" class="md-nav__link">
    Metrics / Monitoring
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-and-disaster-recovery" title="Security and disaster recovery" class="md-nav__link">
    Security and disaster recovery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reusable-components" title="Reusable components" class="md-nav__link">
    Reusable components
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Services</h1>
                
                <p>These are the core services which we provide across our platform.</p>
<h2 id="vpn">VPN<a class="headerlink" href="#vpn" title="Permanent link">#</a></h2>
<p>Many of our services are behind a VPN (using <a href="https://wiki.archlinux.org/index.php/OpenVPN">OpenVPN</a> protocol) for security reasons. We have many different roles and profiles for accessing different environments. These profiles are all found at <a href="https://access-acp.digital.homeoffice.gov.uk">Access ACP</a>.
You can download VPN profiles for the environments you have access to. New profiles can be set up to connect through to things like project specific AWS accounts.
Each profile will expire after a certain amount of time (2-12 hours), users will have to download a new profile once their certificates which are baked into the openvpn profiles expire.</p>
<h2 id="source-code-management">Source Code Management<a class="headerlink" href="#source-code-management" title="Permanent link">#</a></h2>
<h4>GitHub</h4>
<p>GitHub is where we store our open source code. You need to be added to the Uk HomeOffice organisation to access most of our code. More documentation can be found <a href="https://help.github.com/">here</a></p>
<h4>GitLab</h4>
<p><a href="https://gitlab.digital.homeoffice.gov.uk">GitLab</a> is where we store our more private code. Hosted in our ops cluster, you will need an office 365 account to get in via single sign on. Each project has its own group which are managed by members of that project. More in depth guides to gitlab can be found <a href="https://docs.gitlab.com/ce/README.html">here</a>.</p>
<h2 id="ci">CI<a class="headerlink" href="#ci" title="Permanent link">#</a></h2>
<h4>Drone</h4>
<p>Drone is our CI tool for building and deploying applications. We have two instances, one for <a href="https://drone-gitlab.acp.homeoffice.gov.uk">GitLab</a> and one for <a href="https://drone.acp.homeoffice.gov.uk">GitHub</a>. More instructions can be found <a href="how-to-docs/drone-how-to.html">here</a>.</p>
<h4>Jenkins</h4>
<p>Jenkins is considered a legacy system and is not supported.</p>
<h2 id="binary-artifact-storage">Binary / Artifact Storage<a class="headerlink" href="#binary-artifact-storage" title="Permanent link">#</a></h2>
<h4>Quay</h4>
<p><a href="https://quay.io/ukhomeofficedigital">Quay</a> is where store all of our open source container images.</p>
<h4>ECR</h4>
<p>We use AWS ECR to host our private container images for high availability and resiliency. For more information on how to use ECR see <a href="how-to-docs/drone-how-to.html">here</a></p>
<h4>Artifactory</h4>
<p>We use <a href="https://artifactory.digital.homeoffice.gov.uk">Artifactory</a> as our internal binary repository store, projects can push build artifacts / dependencies here. Prior to the introduction of ECR, docker images were also push here, and can be access via https://docker.digital.homeoffice.gov.uk, log in via the Office 365 button to view your artifacts.</p>
<h2 id="domain-name-system-dns-pattern">Domain Name System (DNS) Pattern<a class="headerlink" href="#domain-name-system-dns-pattern" title="Permanent link">#</a></h2>
<p>To standardise on how services route their application traffic to the appropriate hosting platform and to offer consistency in how we approach DNS we have a standard DNS naming convention for services.</p>
<p>In parallel to this, users need to also be aware of <a href="how-to-docs/certificates.html">the limits on certificates and letsencrypt</a> if they are wanting external TLS certificates for their services.</p>
<h4>For Non-production Services</h4>
<p>The following categories are something we would expect a service to specify:</p>
<p><code>Service Name</code> - The name of the service users or other services will attempt to consume i.e. <code>web-portal</code></p>
<p><code>Env</code> - The environment of the service i.e. <code>Dev</code></p>
<p><code>Service</code> - The overall service name or project name i.e. <code>example-service</code></p>
<pre><code>&lt;servicename&gt;.&lt;env&gt;.&lt;service&gt;-notprod.homeoffice.gov.uk

web-portal.dev.example-service-notprod.homeoffice.gov.uk
</code></pre>

<h4>For Production Services</h4>
<p>As we want to protect production services from hitting limits and to create a distinction between services that are non-production, (not prod)  and production, we simplify the overall approach by using the main service name as the domain.</p>
<p><code>Service Name</code> - The name of the service users or other services will attempt to consume i.e. <code>web-portal</code></p>
<p><code>Service</code> - The overall service name or project name i.e. <code>example-service</code></p>
<pre><code>&lt;servicename&gt;.&lt;service&gt;.homeoffice.gov.uk

web-portal.example-service.homeoffice.gov.uk
</code></pre>

<h2 id="application-composition">Application Composition<a class="headerlink" href="#application-composition" title="Permanent link">#</a></h2>
<p>The following are containers that we create for use alongside your own application</p>
<h4>Keycloak Gatekeeper</h4>
<p><a href="https://github.com/keycloak/keycloak-gatekeeper">Keycloak Proxy</a>: a container for putting auth in front of your application.</p>
<h4>Nginx Proxy</h4>
<p><a href="https://github.com/UKHomeOffice/docker-nginx-proxy">Nginx Proxy</a>: for TLS and proxying your application container.</p>
<h4>cfssl Sidekick</h4>
<p><a href="https://github.com/UKHomeOffice/cfssl-sidekick">cfssl-sidecar</a>: for providing a server TLS cert on demand from a cluster hosted cfssl server.</p>
<h2 id="logging">Logging<a class="headerlink" href="#logging" title="Permanent link">#</a></h2>
<p>Logging stack consists of <a href="https://github.com/UKHomeOffice/docker-elasticsearch">Elasticsearch</a>, <a href="https://github.com/UKHomeOffice/docker-logstash-kubernetes">Logstash</a>, <a href="https://github.com/UKHomeOffice/docker-kibana">Kibana</a>).</p>
<ul>
<li>Logstash agents deployed as a daemonSet will collect all workload logs and index them in Elasticsearch.</li>
<li>Logs are searchable for a period of 5 days through <a href="https://kibana.acp.homeoffice.gov.uk">Kibana UI</a>. Access to view logs can be requested via <a href="https://hub.acp.homeoffice.gov.uk/help/support/requests/new/kibana-access-request">Support request</a>.</li>
</ul>
<h4>Current Log Retention Policy</h4>
<ul>
<li>Logs are searchable in Kibana for 5 days and remain within Elasticsearch for 10 days.</li>
<li>Collected workload logs will be persisted in S3 indefinitely and migrated to the infrequent access storage class and then glacier storage after 60 and 180 days respectively. <strong>NOTE: this may change in the future!</strong></li>
<li>The same policy applies to all logs within ELK</li>
</ul>
<h2 id="metrics-monitoring">Metrics / Monitoring<a class="headerlink" href="#metrics-monitoring" title="Permanent link">#</a></h2>
<h4>Sysdig</h4>
<p><a href="https://sysdig.digital.homeoffice.gov.uk">Sysdig</a> is our metric collection tool. We are working closely with Sysdig on the development of this. It can be used for dashboards, alerting and much more. More information can be found on the <a href="https://sysdig.com">Sysdig Monitor site</a> and for the open-source tool, <a href="http://sysdig.org">Sysdig</a> (command line tool) and <a href="https://github.com/draios/sysdig-inspect">Sysdig Inspect</a>.</p>
<h4>Sysdig training</h4>
<p>Sysdig have an online training course which covers the basics of using the product, <a href="https://sysdig.teachable.com/">Sysdig 101</a>. Sysdig recommends new users complete this training.</p>
<h2 id="security-and-disaster-recovery">Security and disaster recovery<a class="headerlink" href="#security-and-disaster-recovery" title="Permanent link">#</a></h2>
<p>The Application Container Platform employs robust security principles, including but not limited to:</p>
<ul>
<li>encryption of data at rest and in transit</li>
<li>restricting access to resources according to operational needs</li>
<li>strict authorisation requirements for all endpoints</li>
<li><a href="rbac.html">role based access control</a></li>
</ul>
<p>The Platform is spread across multiple availability zones, which are essentially three different data centres within a region. In case of an entire AWS region going down for a prolonged period of time, the Platform can be recreated in another region within a few hours.</p>
<p>The recovery of products hosted on the Platform are subject to considerations set out for the Production Ready criteria in <a href="service-lifecycle.html">Service Lifecycle</a>.</p>
<p>For further information on security and disaster recovery considerations, please raise a ticket on the <a href="https://github.com/UKHomeOffice/application-container-platform-bau/issues">BAU Board</a>.</p>
<h2 id="reusable-components">Reusable components<a class="headerlink" href="#reusable-components" title="Permanent link">#</a></h2>
<p>Whilst building ACP, we've written a things that other projects may be interested in reusing. These can be found on GitHub here</p>
<h4><a href="https://github.com/UKHomeOffice?utf8=%E2%9C%93&amp;q=acp-tf&amp;type=&amp;language=">Terraform modules</a></h4>
<h4><a href="https://github.com/UKHomeOffice?utf8=%E2%9C%93&amp;q=docker-&amp;type=&amp;language=">Base docker images</a></h4>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="index.html" title="Home" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Home
              </span>
            </div>
          </a>
        
        
          <a href="releases-notes/index.html" title="Release Notes" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Release Notes
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/application.2ba8dec4.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"."}})</script>
      
    
  </body>
</html>